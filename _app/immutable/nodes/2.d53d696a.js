var Vt=Object.defineProperty;var Bt=(n,e,t)=>e in n?Vt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ee=(n,e,t)=>(Bt(n,typeof e!="symbol"?e+"":e,t),t);import{s as Se,n as ce,r as Mt}from"../chunks/scheduler.e108d1fd.js";import{S as Ie,i as ke,e as le,a as N,f as m,y as ne,z as ie,j as D,k as w,A as ze,m as X,n as q,x as b,g as O,h as $,d as G,p as Be,b as Ue,t as Z,r as he,s as Y,u as de,c as H,B as Ne,v as me,C as ye,w as pe,o as xe,l as ue,D as Nt}from"../chunks/index.c2aa4371.js";function fe(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}var A=(n=>(n.ROAD="D",n.RAIL="L",n.NONE="_",n.EDGE="E",n.UNFILLED=".",n))(A||{});const re=class re{constructor(e){ee(this,"data");this.data=e??[]}static fromList(e){const t=new re;for(const{y:i,x:r,v:u}of e)t.set({y:i,x:r},u);return t}get({y:e,x:t}){return this.data[e*re.size+t]}set({y:e,x:t},i){this.data[e*re.size+t]=i}delete({y:e,x:t}){delete this.data[e*re.size+t]}forEach(e){for(let t=0;t<re.size;t++)for(let i=0;i<re.size;i++){const r={y:t,x:i},u=this.get(r);u!==void 0&&e(r,u)}}entries(){const e=[];for(let t=0;t<re.size*re.size;t++){const i=this.data[t];if(i!==void 0){const r={y:Math.floor(t/re.size),x:t%re.size};e.push([r,i])}}return e}clone(){return new re([...this.data])}};ee(re,"size",7);let we=re;const Ee=class Ee{constructor(e){ee(this,"tiles");ee(this,"openSlots");this.tiles=(e==null?void 0:e.tiles)??we.fromList([]),this.openSlots=(e==null?void 0:e.openSlots)??Ee.exitSlots}get(e){return this.tiles.get(e)}tileEntries(){return this.tiles.entries()}getOpenSlot(e){return this.openSlots.get(e)}openSlotEntries(){return this.openSlots.entries()}forEachTile(e){return this.tiles.forEach(e)}countErrors(){let e=0,t=0;return this.forEachTile(({y:i,x:r},u)=>{for(const l of te){if(u[l]==="_")continue;const s=$e({y:i,x:r},l);if(!s)continue;const o=this.get(s);o&&o[je(l)]!=="_"||(o&&t++,e++)}}),{total:e,unfixable:t}}isValid(e,t){const i=this.openSlots.get(e);return!!i&&zt(t,i)}isValidWithTransform(e,t){for(const i of Ce(t))if(this.isValid(e,i))return!0;return!1}getAllValidTransformedTiles(e,t){return Ce(t).filter(i=>this.isValid(e,i))}getConnectedTiles(e,t){const i=this.get(e);if(!i)throw new Error("No tile at coordinates");const r=[];for(const u of te){const l=i[u];if(l==="_"||t&&l!==t||Re(i)&&l!==e.t)continue;const s=$e(e,u);if(!s)continue;const o=this.get(s);o&&o[je(u)]===l&&r.push({y:s.y,x:s.x,t:l})}return r}set(e,t){if(!this.isValid(e,t))throw new Error("Invalid tile placement");const i=this.tiles.clone();i.set(e,t);const r=this.openSlots.clone();r.delete(e);for(const u of te){const l=$e(e,u);if(!l||this.get(l))continue;const s=t[u],o=r.get(l);if(s===A.NONE){if(o){const c=lt(je(u),A.NONE,o);r.set(l,c)}}else{const c=lt(je(u),s,o??this.calculateSlot(l));r.set(l,c)}}return new Ee({tiles:i,openSlots:r})}calculateSlot(e){return te.map(t=>{if(!$e(e,t))return A.EDGE;const r=this.get(e);return r?r[t]:A.UNFILLED}).join("")}};ee(Ee,"size",we.size),ee(Ee,"exitSlots",we.fromList([{y:0,x:1,v:"D..."},{y:0,x:3,v:"L..."},{y:0,x:5,v:"D..."},{y:1,x:6,v:".L.."},{y:3,x:6,v:".D.."},{y:5,x:6,v:".L.."},{y:6,x:5,v:"..D."},{y:6,x:3,v:"..L."},{y:6,x:1,v:"..D."},{y:5,x:0,v:"...L"},{y:3,x:0,v:"...D"},{y:1,x:0,v:"...L"}]));let V=Ee;function $e(n,e){const t={y:e===0?n.y-1:e===2?n.y+1:n.y,x:e===1?n.x+1:e===3?n.x-1:n.x};if(!(t.y<0||t.x<0||t.y>=V.size||t.x>=V.size))return t}function Le(n,e,t=!0){return(t?n+e:4+n-e)%4}function je(n){return Le(n,2)}const te=[0,1,2,3];function Re(n){return n[4]==="o"}function Ge(n,e){return te.some(t=>n[t]===e)}function Ut(n,e=1){return`${n[Le(0,e,!1)]}${n[Le(1,e,!1)]}${n[Le(2,e,!1)]}${n[Le(3,e,!1)]}${n[4]??""}`}function Kt(n){return`${n[0]}${n[3]}${n[2]}${n[1]}${n[4]??""}`}function Xt(n){const e={};return t=>(t in e||(e[t]=n(t)),e[t])}function qt(n){const e={};return(t,i)=>((!(t in e)||!(i in e[t]))&&(t in e||(e[t]={}),e[t][i]=n(t,i)),e[t][i])}const Ce=Xt(n=>{const e=[];for(const t of te)for(const i of[!1,!0]){const r=Gt(n,{rotation:t,flip:i});e.includes(r)||e.push(r)}return e});function Gt(n,e){const t=Ut(n,e.rotation??0);return e.flip?Kt(t):t}function Lt(n){return n.y>=2&&n.y<=4&&n.x>=2&&n.x<=4}function Ae(n,e=Math.random){return n[Math.floor(e()*n.length)]}function Xe(n){const e=[...n];for(let t=n.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function zt(n,e){let t=0;for(const i of te){const r=n[i],u=e[i];if(!(r===A.NONE||u===A.NONE||u===A.UNFILLED||u===A.EDGE)){if(r!==u)return!1;t++}}return t>=1}function lt(n,e,t){return t.substring(0,n)+e+t.substring(n+1)}function Rt(n){const e=n.slice(2),t=parseInt(n[0],10),i=parseInt(n[1],10);return{p:{y:t,x:i},t:e}}function Je(n,e){return`${n.y}${n.x}${e}`}function Pe(n,e){return n.map(t=>[t,e(t)]).reduce((t,i)=>t[1]>i[1]?t:i)[0]}function st(n,e,t){const i=n.slice();return i[4]=e[t],i}function ct(n){let e,t=fe(te),i=[];for(let r=0;r<t.length;r+=1)i[r]=mt(st(n,t,r));return{c(){e=ne("svg");for(let r=0;r<i.length;r+=1)i[r].c();this.h()},l(r){e=ie(r,"svg",{viewBox:!0,width:!0,height:!0,stroke:!0,display:!0,"stroke-width":!0});var u=D(e);for(let l=0;l<i.length;l+=1)i[l].l(u);u.forEach(m),this.h()},h(){w(e,"viewBox","0 0 100 100"),w(e,"width",n[1]),w(e,"height",n[1]),w(e,"stroke","black"),w(e,"display","block"),w(e,"stroke-width",3)},m(r,u){N(r,e,u);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null)},p(r,u){if(u&13){t=fe(te);let l;for(l=0;l<t.length;l+=1){const s=st(r,t,l);i[l]?i[l].p(s,u):(i[l]=mt(s),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=t.length}u&2&&w(e,"width",r[1]),u&2&&w(e,"height",r[1])},d(r){r&&m(e),ze(i,r)}}}function Ft(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{d:!0}),D(e).forEach(m),this.h()},h(){w(e,"d","M50,0 v51 M41,8 h18 m-18,12 h18 m-18,12 h18")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function Wt(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{fill:!0,d:!0}),D(e).forEach(m),this.h()},h(){w(e,"fill","transparent"),w(e,"d","M50,0 v31 M41,8 h18 m-18,12 h18 M30,28 q20,6 40,0")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function Yt(n){let e,t;return{c(){e=ne("path"),t=ne("path"),this.h()},l(i){e=ie(i,"path",{d:!0}),D(e).forEach(m),t=ie(i,"path",{"stroke-width":!0,d:!0}),D(t).forEach(m),this.h()},h(){w(e,"d","M40,0 v41 M60,0 v41"),w(t,"stroke-width",2),w(t,"d","M50,4 v9 m0,6 v9 m0,6 v9")},m(i,r){N(i,e,r),N(i,t,r)},d(i){i&&(m(e),m(t))}}}function ut(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{d:!0}),D(e).forEach(m),this.h()},h(){w(e,"d","M39,40 h22")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function ft(n){let e;return{c(){e=ne("rect"),this.h()},l(t){e=ie(t,"rect",{x:!0,y:!0,width:!0,height:!0}),D(e).forEach(m),this.h()},h(){w(e,"x",39),w(e,"y",39),w(e,"width",22),w(e,"height",22)},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function at(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{d:!0}),D(e).forEach(m),this.h()},h(){w(e,"d","M43,43 l14,14 m0,-14 l-14,14")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function ht(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{d:!0}),D(e).forEach(m),this.h()},h(){w(e,"d","M50,41 v18")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function dt(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{d:!0}),D(e).forEach(m),this.h()},h(){w(e,"d","M41,50 h18")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function mt(n){let e,t,i,r=n[3](n[0],n[4]),u,l=n[2](n[0]),s,o=pt(n[0]),c,a=vt(n[0]),f,h=_t(n[0]),d;function v(p,y){if(y&1&&(t=null),p[0][p[4]]==="D")return Yt;if(t==null&&(t=!!(p[0][p[4]]==="L"&&Re(p[0]))),t)return Wt;if(p[0][p[4]]==="L")return Ft}let E=v(n,-1),I=E&&E(n),_=r&&ut(),k=l&&ft(),M=o&&at(),T=a&&ht(),x=h&&dt();return{c(){e=ne("g"),I&&I.c(),i=le(),_&&_.c(),u=X(`
      ))}

      `),k&&k.c(),s=le(),M&&M.c(),c=le(),T&&T.c(),f=le(),x&&x.c(),d=le(),this.h()},l(p){e=ie(p,"g",{transform:!0});var y=D(e);I&&I.l(y),i=le(),_&&_.l(y),y.forEach(m),u=q(p,`
      ))}

      `),k&&k.l(p),s=le(),M&&M.l(p),c=le(),T&&T.l(p),f=le(),x&&x.l(p),d=le(),this.h()},h(){w(e,"transform",`rotate(${n[4]*90}, 50, 50)`)},m(p,y){N(p,e,y),I&&I.m(e,null),b(e,i),_&&_.m(e,null),N(p,u,y),k&&k.m(p,y),N(p,s,y),M&&M.m(p,y),N(p,c,y),T&&T.m(p,y),N(p,f,y),x&&x.m(p,y),N(p,d,y)},p(p,y){E!==(E=v(p,y))&&(I&&I.d(1),I=E&&E(p),I&&(I.c(),I.m(e,i))),y&1&&(r=p[3](p[0],p[4])),r?_||(_=ut(),_.c(),_.m(e,null)):_&&(_.d(1),_=null),y&1&&(l=p[2](p[0])),l?k||(k=ft(),k.c(),k.m(s.parentNode,s)):k&&(k.d(1),k=null),y&1&&(o=pt(p[0])),o?M||(M=at(),M.c(),M.m(c.parentNode,c)):M&&(M.d(1),M=null),y&1&&(a=vt(p[0])),a?T||(T=ht(),T.c(),T.m(f.parentNode,f)):T&&(T.d(1),T=null),y&1&&(h=_t(p[0])),h?x||(x=dt(),x.c(),x.m(d.parentNode,d)):x&&(x.d(1),x=null)},d(p){p&&(m(e),m(u),m(s),m(c),m(f),m(d)),I&&I.d(),_&&_.d(),k&&k.d(p),M&&M.d(p),T&&T.d(p),x&&x.d(p)}}}function Ht(n){let e,t=n[0]&&ct(n);return{c(){t&&t.c(),e=le()},l(i){t&&t.l(i),e=le()},m(i,r){t&&t.m(i,r),N(i,e,r)},p(i,[r]){i[0]?t?t.p(i,r):(t=ct(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ce,o:ce,d(i){i&&m(e),t&&t.d(i)}}}function Jt(n){const e={D:0,L:0,_:0};return e[n[0]]++,e[n[1]]++,e[n[2]]++,e[n[3]]++,e}function pt(n){const e=Jt(n);return e.L===4||e.L===3&&e._===1}function vt(n){return n[0]==="_"&&n[1]==="L"&&n[2]==="_"&&n[3]==="L"}function _t(n){return n[0]==="L"&&n[1]==="_"&&n[2]==="L"&&n[3]==="_"}function Qt(n,e,t){let{tile:i}=e,{size:r=60}=e;function u(s){return!Re(s)&&Ge(s,A.ROAD)&&Ge(s,A.RAIL)}function l(s,o){return(s[o]==="_"||s[o]==="L"&&Re(s))&&(s[(o+3)%4]==="D"||s[(o+1)%4]==="D")}return n.$$set=s=>{"tile"in s&&t(0,i=s.tile),"size"in s&&t(1,r=s.size)},[i,r,u,l]}class Qe extends Ie{constructor(e){super(),ke(this,e,Qt,Ht,Se,{tile:0,size:1})}}function gt(n,e,t){const i=n.slice();return i[6]=e[t],i[8]=t,i}function xt(n){let e,t,i,r,u,l,s;t=new Qe({props:{tile:n[6],size:60}});function o(){return n[5](n[8])}return{c(){e=O("button"),he(t.$$.fragment),i=Y(),this.h()},l(c){e=$(c,"BUTTON",{class:!0});var a=D(e);de(t.$$.fragment,a),i=H(a),a.forEach(m),this.h()},h(){w(e,"class","tileContainer svelte-riolc9"),e.disabled=r=n[2].includes(n[8])||n[0],Ne(e,"selected",n[3]===n[8]),Ne(e,"used",n[2].includes(n[8]))},m(c,a){N(c,e,a),me(t,e,null),b(e,i),u=!0,l||(s=ye(e,"click",o),l=!0)},p(c,a){n=c;const f={};a&2&&(f.tile=n[6]),t.$set(f),(!u||a&5&&r!==(r=n[2].includes(n[8])||n[0]))&&(e.disabled=r),(!u||a&8)&&Ne(e,"selected",n[3]===n[8]),(!u||a&4)&&Ne(e,"used",n[2].includes(n[8]))},i(c){u||(G(t.$$.fragment,c),u=!0)},o(c){Z(t.$$.fragment,c),u=!1},d(c){c&&m(e),pe(t),l=!1,s()}}}function Zt(n){let e,t,i=fe(n[1]),r=[];for(let l=0;l<i.length;l+=1)r[l]=xt(gt(n,i,l));const u=l=>Z(r[l],1,1,()=>{r[l]=null});return{c(){e=O("div");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=$(l,"DIV",{class:!0});var s=D(e);for(let o=0;o<r.length;o+=1)r[o].l(s);s.forEach(m),this.h()},h(){w(e,"class","container svelte-riolc9")},m(l,s){N(l,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null);t=!0},p(l,[s]){if(s&31){i=fe(l[1]);let o;for(o=0;o<i.length;o+=1){const c=gt(l,i,o);r[o]?(r[o].p(c,s),G(r[o],1)):(r[o]=xt(c),r[o].c(),G(r[o],1),r[o].m(e,null))}for(Be(),o=i.length;o<r.length;o+=1)u(o);Ue()}},i(l){if(!t){for(let s=0;s<i.length;s+=1)G(r[s]);t=!0}},o(l){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Z(r[s]);t=!1},d(l){l&&m(e),ze(r,l)}}}function en(n,e,t){let{disabled:i=!1}=e,{tiles:r}=e,{usedTileIndexes:u}=e,{selectedTileIndex:l}=e,{onSelectTile:s}=e;const o=c=>u.includes(c)||s(c);return n.$$set=c=>{"disabled"in c&&t(0,i=c.disabled),"tiles"in c&&t(1,r=c.tiles),"usedTileIndexes"in c&&t(2,u=c.usedTileIndexes),"selectedTileIndex"in c&&t(3,l=c.selectedTileIndex),"onSelectTile"in c&&t(4,s=c.onSelectTile)},[i,r,u,l,s,o]}class bt extends Ie{constructor(e){super(),ke(this,e,en,Zt,Se,{disabled:0,tiles:1,usedTileIndexes:2,selectedTileIndex:3,onSelectTile:4})}}function Ke(n){const e=Ot(n),t=Tt(n,A.ROAD),i=Tt(n,A.RAIL),r=nn(n),u=tn(n),l=e+t+i+r+u;return{exits:e,road:t,rail:i,center:r,errors:u,total:l}}function tn(n){return-1*n.countErrors().total||0}function nn(n){let e=0;for(let t=0;t<=V.size;t++)for(let i=0;i<=V.size;i++)Lt({y:t,x:i})&&n.get({y:t,x:i})&&e++;return e}const on={2:4,3:8,4:12,5:16,6:20,7:24,8:28,9:32,10:36,11:40,12:45};function Ot(n,e=!1){if(e){let u=n.openSlotEntries();for(;u.length>0;){for(const[l,s]of u){const o=s.replace(/[_.E]/g,"D");n=n.set(l,o)}u=n.openSlotEntries()}}const t=we.fromList([]);n.forEachTile((u,l)=>{let s,o;if(u.x>0&&l[3]!=="_"){const c={y:u.y,x:u.x-1},a=n.get(c),f=t.get(c);a&&a[1]!=="_"&&f&&(s=f.horizontal)}if(u.y>0&&l[0]!=="_"){const c={y:u.y-1,x:u.x},a=n.get(c),f=t.get(c);a&&a[2]!=="_"&&f&&(o=f.vertical)}Re(l)?t.set(u,{horizontal:s??`${u.y}${u.x}h`,vertical:o??`${u.y}${u.x}v`}):s!==void 0&&o!==void 0?(t.forEach((c,a)=>{a.horizontal===s&&(a.horizontal=o),a.vertical===s&&(a.vertical=o)}),t.set(u,{horizontal:o,vertical:o})):o!==void 0?t.set(u,{horizontal:o,vertical:o}):s!==void 0?t.set(u,{horizontal:s,vertical:s}):t.set(u,{horizontal:`${u.y}${u.x}`,vertical:`${u.y}${u.x}`})});const i={};for(const[u,l]of V.exitSlots.entries()){const s=n.get(u);if(!s||!zt(s,l))continue;const o=t.get(u);if(!o)throw new Error("Could not find network values");const a=l[1]==="."&&l[3]==="."?o.vertical:o.horizontal;i[a]=(i[a]??0)+1}let r=0;for(const u of Object.values(i))r+=on[u]??0;return r}function Tt(n,e){const t=Array.from({length:V.size*V.size},()=>[]);let i=0;for(let l=0;l<V.size;l++)for(let s=0;s<V.size;s++){const o=l*V.size+s,c=n.get({y:l,x:s});if((c==null?void 0:c[1])===e&&s<V.size-1){const a=l*V.size+s+1,f=n.get({y:l,x:s+1});if((f==null?void 0:f[3])===e){const h=1<<i++;t[o].push({toI:a,path:h}),t[a].push({toI:o,path:h})}}if((c==null?void 0:c[2])===e&&l<V.size-1){const a=(l+1)*V.size+s,f=n.get({y:l+1,x:s});if((f==null?void 0:f[0])===e){const h=1<<i++;t[o].push({toI:a,path:h}),t[a].push({toI:o,path:h})}}}if(i===0)return rn(n,e)?1:0;for(let l=0;l<t.length;l++)if(t[l].length===2&&t[l][0].toI!==l){const[s,o]=t[l],c=s.path|o.path,a=t[s.toI].find(({toI:h})=>h===l);a.toI=o.toI,a.path=c;const f=t[o.toI].find(({toI:h})=>h===l);f.toI=s.toI,f.path=c,t[l]=[]}for(let l=0;l<t.length;l++)if(t[l].length===3&&t[l].filter(o=>t[o.toI].length>1).length<=1){const o=Pe(t[l],c=>-1*Fe(c.path));if(t[o.toI].length===1){t[o.toI]=[],t[l]=t[l].filter(v=>v!==o);const[c,a]=t[l],f=c.path|a.path,h=t[c.toI].find(({toI:v})=>v===l);h.toI=a.toI,h.path=f;const d=t[a.toI].find(({toI:v})=>v===l);d.toI=c.toI,d.path=f,t[l]=[]}}let r=0;function u(l){const s=Fe(l);s>r&&(r=s)}for(let l=0;l<t.length;l++)t[l].length!==0&&$t(u,t,l);return r}function rn(n,e){for(const[,t]of n.tileEntries())if(Ge(t,e))return!0;return!1}function Fe(n){return n===0?1:(n&1)+Fe(n>>1)}function $t(n,e,t,i=0){const r=e[t].filter(u=>(i&u.path)===0);if(r.length===0)n(i);else for(const u of r)$t(n,e,u.toI,i|u.path)}function ln(n){let e,t,i,r=n[0].exits+"",u,l,s,o,c=n[0].road+"",a,f,h,d,v=n[0].rail+"",E,I,_,k,M=n[0].center+"",T,x,p,y,z=n[0].errors+"",C,U,P,K,J,Q=n[0].total+"",oe;return{c(){e=O("div"),t=O("span"),i=X("Exits: "),u=X(r),l=Y(),s=O("span"),o=X("Road: "),a=X(c),f=Y(),h=O("span"),d=X("Rail: "),E=X(v),I=Y(),_=O("span"),k=X("Center: "),T=X(M),x=Y(),p=O("span"),y=X("Errors: "),C=X(z),U=Y(),P=O("span"),K=O("strong"),J=X("Total: "),oe=X(Q),this.h()},l(L){e=$(L,"DIV",{class:!0});var R=D(e);t=$(R,"SPAN",{class:!0});var j=D(t);i=q(j,"Exits: "),u=q(j,r),j.forEach(m),l=H(R),s=$(R,"SPAN",{class:!0});var De=D(s);o=q(De,"Road: "),a=q(De,c),De.forEach(m),f=H(R),h=$(R,"SPAN",{class:!0});var ve=D(h);d=q(ve,"Rail: "),E=q(ve,v),ve.forEach(m),I=H(R),_=$(R,"SPAN",{class:!0});var F=D(_);k=q(F,"Center: "),T=q(F,M),F.forEach(m),x=H(R),p=$(R,"SPAN",{class:!0});var g=D(p);y=q(g,"Errors: "),C=q(g,z),g.forEach(m),U=H(R),P=$(R,"SPAN",{class:!0});var S=D(P);K=$(S,"STRONG",{});var B=D(K);J=q(B,"Total: "),oe=q(B,Q),B.forEach(m),S.forEach(m),R.forEach(m),this.h()},h(){w(t,"class","item svelte-m3jxn2"),w(s,"class","item svelte-m3jxn2"),w(h,"class","item svelte-m3jxn2"),w(_,"class","item svelte-m3jxn2"),w(p,"class","item svelte-m3jxn2"),w(P,"class","item svelte-m3jxn2"),w(e,"class","container svelte-m3jxn2")},m(L,R){N(L,e,R),b(e,t),b(t,i),b(t,u),b(e,l),b(e,s),b(s,o),b(s,a),b(e,f),b(e,h),b(h,d),b(h,E),b(e,I),b(e,_),b(_,k),b(_,T),b(e,x),b(e,p),b(p,y),b(p,C),b(e,U),b(e,P),b(P,K),b(K,J),b(K,oe)},p(L,[R]){R&1&&r!==(r=L[0].exits+"")&&xe(u,r),R&1&&c!==(c=L[0].road+"")&&xe(a,c),R&1&&v!==(v=L[0].rail+"")&&xe(E,v),R&1&&M!==(M=L[0].center+"")&&xe(T,M),R&1&&z!==(z=L[0].errors+"")&&xe(C,z),R&1&&Q!==(Q=L[0].total+"")&&xe(oe,Q)},i:ce,o:ce,d(L){L&&m(e)}}}function sn(n,e,t){let i,{board:r}=e;return n.$$set=u=>{"board"in u&&t(1,r=u.board)},n.$$.update=()=>{n.$$.dirty&2&&t(0,i=Ke(r))},[i,r]}class cn extends Ie{constructor(e){super(),ke(this,e,sn,ln,Se,{board:1})}}var be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function un(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function fn(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var Ze={exports:{}};Ze.exports;(function(n){(function(e,t,i){function r(o){var c=this,a=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=a(" "),c.s1=a(" "),c.s2=a(" "),c.s0-=a(o),c.s0<0&&(c.s0+=1),c.s1-=a(o),c.s1<0&&(c.s1+=1),c.s2-=a(o),c.s2<0&&(c.s2+=1),a=null}function u(o,c){return c.c=o.c,c.s0=o.s0,c.s1=o.s1,c.s2=o.s2,c}function l(o,c){var a=new r(o),f=c&&c.state,h=a.next;return h.int32=function(){return a.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&u(f,a),h.state=function(){return u(a,{})}),h}function s(){var o=4022871197,c=function(a){a=String(a);for(var f=0;f<a.length;f++){o+=a.charCodeAt(f);var h=.02519603282416938*o;o=h>>>0,h-=o,h*=o,o=h>>>0,h-=o,o+=h*4294967296}return(o>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=l:i&&i.amd?i(function(){return l}):this.alea=l})(be,n,!1)})(Ze);var an=Ze.exports,et={exports:{}};et.exports;(function(n){(function(e,t,i){function r(s){var o=this,c="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var f=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^f^f>>>8},s===(s|0)?o.x=s:c+=s;for(var a=0;a<c.length+64;a++)o.x^=c.charCodeAt(a)|0,o.next()}function u(s,o){return o.x=s.x,o.y=s.y,o.z=s.z,o.w=s.w,o}function l(s,o){var c=new r(s),a=o&&o.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,v=(h+d)/(1<<21);while(v===0);return v},f.int32=c.next,f.quick=f,a&&(typeof a=="object"&&u(a,c),f.state=function(){return u(c,{})}),f}t&&t.exports?t.exports=l:i&&i.amd?i(function(){return l}):this.xor128=l})(be,n,!1)})(et);var hn=et.exports,tt={exports:{}};tt.exports;(function(n){(function(e,t,i){function r(s){var o=this,c="";o.next=function(){var f=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^(f^f<<1))|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,s===(s|0)?o.x=s:c+=s;for(var a=0;a<c.length+64;a++)o.x^=c.charCodeAt(a)|0,a==c.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function u(s,o){return o.x=s.x,o.y=s.y,o.z=s.z,o.w=s.w,o.v=s.v,o.d=s.d,o}function l(s,o){var c=new r(s),a=o&&o.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,v=(h+d)/(1<<21);while(v===0);return v},f.int32=c.next,f.quick=f,a&&(typeof a=="object"&&u(a,c),f.state=function(){return u(c,{})}),f}t&&t.exports?t.exports=l:i&&i.amd?i(function(){return l}):this.xorwow=l})(be,n,!1)})(tt);var dn=tt.exports,nt={exports:{}};nt.exports;(function(n){(function(e,t,i){function r(s){var o=this;o.next=function(){var a=o.x,f=o.i,h,d;return h=a[f],h^=h>>>7,d=h^h<<24,h=a[f+1&7],d^=h^h>>>10,h=a[f+3&7],d^=h^h>>>3,h=a[f+4&7],d^=h^h<<7,h=a[f+7&7],h=h^h<<13,d^=h^h<<9,a[f]=d,o.i=f+1&7,d};function c(a,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],a.x=d,a.i=0,h=256;h>0;--h)a.next()}c(o,s)}function u(s,o){return o.x=s.x.slice(),o.i=s.i,o}function l(s,o){s==null&&(s=+new Date);var c=new r(s),a=o&&o.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,v=(h+d)/(1<<21);while(v===0);return v},f.int32=c.next,f.quick=f,a&&(a.x&&u(a,c),f.state=function(){return u(c,{})}),f}t&&t.exports?t.exports=l:i&&i.amd?i(function(){return l}):this.xorshift7=l})(be,n,!1)})(nt);var mn=nt.exports,it={exports:{}};it.exports;(function(n){(function(e,t,i){function r(s){var o=this;o.next=function(){var a=o.w,f=o.X,h=o.i,d,v;return o.w=a=a+1640531527|0,v=f[h+34&127],d=f[h=h+1&127],v^=v<<13,d^=d<<17,v^=v>>>15,d^=d>>>12,v=f[h]=v^d,o.i=h,v+(a^a>>>16)|0};function c(a,f){var h,d,v,E,I,_=[],k=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,k=Math.max(k,f.length)),v=0,E=-32;E<k;++E)f&&(d^=f.charCodeAt((E+32)%f.length)),E===0&&(I=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,E>=0&&(I=I+1640531527|0,h=_[E&127]^=d+I,v=h==0?v+1:0);for(v>=128&&(_[(f&&f.length||0)&127]=-1),v=127,E=4*128;E>0;--E)d=_[v+34&127],h=_[v=v+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,_[v]=d^h;a.w=I,a.X=_,a.i=v}c(o,s)}function u(s,o){return o.i=s.i,o.w=s.w,o.X=s.X.slice(),o}function l(s,o){s==null&&(s=+new Date);var c=new r(s),a=o&&o.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,v=(h+d)/(1<<21);while(v===0);return v},f.int32=c.next,f.quick=f,a&&(a.X&&u(a,c),f.state=function(){return u(c,{})}),f}t&&t.exports?t.exports=l:i&&i.amd?i(function(){return l}):this.xor4096=l})(be,n,!1)})(it);var pn=it.exports,ot={exports:{}};ot.exports;(function(n){(function(e,t,i){function r(s){var o=this,c="";o.next=function(){var f=o.b,h=o.c,d=o.d,v=o.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^v,v=v-f|0,o.b=f=f<<20^f>>>12^h,o.c=h=h-d|0,o.d=d<<16^h>>>16^v,o.a=v-f|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,s===Math.floor(s)?(o.a=s/4294967296|0,o.b=s|0):c+=s;for(var a=0;a<c.length+20;a++)o.b^=c.charCodeAt(a)|0,o.next()}function u(s,o){return o.a=s.a,o.b=s.b,o.c=s.c,o.d=s.d,o}function l(s,o){var c=new r(s),a=o&&o.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,v=(h+d)/(1<<21);while(v===0);return v},f.int32=c.next,f.quick=f,a&&(typeof a=="object"&&u(a,c),f.state=function(){return u(c,{})}),f}t&&t.exports?t.exports=l:i&&i.amd?i(function(){return l}):this.tychei=l})(be,n,!1)})(ot);var vn=ot.exports,jt={exports:{}};const _n={},gn=Object.freeze(Object.defineProperty({__proto__:null,default:_n},Symbol.toStringTag,{value:"Module"})),xn=fn(gn);(function(n){(function(e,t,i){var r=256,u=6,l=52,s="random",o=i.pow(r,u),c=i.pow(2,l),a=c*2,f=r-1,h;function d(T,x,p){var y=[];x=x==!0?{entropy:!0}:x||{};var z=_(I(x.entropy?[T,M(t)]:T??k(),3),y),C=new v(y),U=function(){for(var P=C.g(u),K=o,J=0;P<c;)P=(P+J)*r,K*=r,J=C.g(1);for(;P>=a;)P/=2,K/=2,J>>>=1;return(P+J)/K};return U.int32=function(){return C.g(4)|0},U.quick=function(){return C.g(4)/4294967296},U.double=U,_(M(C.S),t),(x.pass||p||function(P,K,J,Q){return Q&&(Q.S&&E(Q,C),P.state=function(){return E(C,{})}),J?(i[s]=P,K):P})(U,z,"global"in x?x.global:this==i,x.state)}function v(T){var x,p=T.length,y=this,z=0,C=y.i=y.j=0,U=y.S=[];for(p||(T=[p++]);z<r;)U[z]=z++;for(z=0;z<r;z++)U[z]=U[C=f&C+T[z%p]+(x=U[z])],U[C]=x;(y.g=function(P){for(var K,J=0,Q=y.i,oe=y.j,L=y.S;P--;)K=L[Q=f&Q+1],J=J*r+L[f&(L[Q]=L[oe=f&oe+K])+(L[oe]=K)];return y.i=Q,y.j=oe,J})(r)}function E(T,x){return x.i=T.i,x.j=T.j,x.S=T.S.slice(),x}function I(T,x){var p=[],y=typeof T,z;if(x&&y=="object")for(z in T)try{p.push(I(T[z],x-1))}catch{}return p.length?p:y=="string"?T:T+"\0"}function _(T,x){for(var p=T+"",y,z=0;z<p.length;)x[f&z]=f&(y^=x[f&z]*19)+p.charCodeAt(z++);return M(x)}function k(){try{var T;return h&&(T=h.randomBytes)?T=T(r):(T=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(T)),M(T)}catch{var x=e.navigator,p=x&&x.plugins;return[+new Date,e,p,e.screen,M(t)]}}function M(T){return String.fromCharCode.apply(0,T)}if(_(i.random(),t),n.exports){n.exports=d;try{h=xn}catch{}}else i["seed"+s]=d})(typeof self<"u"?self:be,[],Math)})(jt);var bn=jt.exports,Tn=an,En=hn,wn=dn,yn=mn,Sn=pn,In=vn,Te=bn;Te.alea=Tn;Te.xor128=En;Te.xorwow=wn;Te.xorshift7=yn;Te.xor4096=Sn;Te.tychei=In;var kn=Te;const Dn=un(kn),qe=["_D_D","_L_L","_DD_","_LL_","_DDD","_LLL"],Mn=["DLDLo","_D_L","__DL"],Ve=["DDLD","DLLL","DDDD","LLLL","DLLD","DLDL"];function We(n=Math.random){return[Ae(qe,n),Ae(qe,n),Ae(qe,n),Ae(Mn,n)]}function Nn(n){const e=Dn(n==null?void 0:n.toString());return Array.from({length:7},()=>We(e))}function Ln(n){let e;return{c(){e=ne("path"),this.h()},l(t){e=ie(t,"path",{d:!0}),D(e).forEach(m),this.h()},h(){w(e,"d","M50,60 v40 M41,69 h18 m-18,10 h18 m-18,10 h18")},m(t,i){N(t,e,i)},d(t){t&&m(e)}}}function zn(n){let e,t;return{c(){e=ne("path"),t=ne("path"),this.h()},l(i){e=ie(i,"path",{d:!0}),D(e).forEach(m),t=ie(i,"path",{"stroke-width":!0,d:!0}),D(t).forEach(m),this.h()},h(){w(e,"d","M40,60 v50 M60,60 v50"),w(t,"stroke-width",2),w(t,"d","M50,69 v9 m0,6 v9")},m(i,r){N(i,e,r),N(i,t,r)},d(i){i&&(m(e),m(t))}}}function Rn(n){let e;function t(u,l){return u[0][u[2]]==="D"?zn:Ln}let i=t(n),r=i(n);return{c(){e=ne("svg"),r.c(),this.h()},l(u){e=ie(u,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var l=D(e);r.l(l),l.forEach(m),this.h()},h(){w(e,"class","exit svelte-1lb11pp"),w(e,"viewBox","0 0 100 100"),w(e,"width",n[1]),w(e,"height",n[1]),ue(e,"transform",n[3])},m(u,l){N(u,e,l),r.m(e,null)},p(u,[l]){i!==(i=t(u))&&(r.d(1),r=i(u),r&&(r.c(),r.m(e,null))),l&2&&w(e,"width",u[1]),l&2&&w(e,"height",u[1]),l&8&&ue(e,"transform",u[3])},i:ce,o:ce,d(u){u&&m(e),r.d()}}}function On(n,e,t){let i,r,{position:u}=e,{exitSlot:l}=e,{cellSize:s}=e,{cellBorderSize:o}=e;return n.$$set=c=>{"position"in c&&t(4,u=c.position),"exitSlot"in c&&t(0,l=c.exitSlot),"cellSize"in c&&t(1,s=c.cellSize),"cellBorderSize"in c&&t(5,o=c.cellBorderSize)},n.$$.update=()=>{n.$$.dirty&1&&t(2,i=te.find(c=>l[c]==="D"||l[c]==="L")??0),n.$$.dirty&54&&t(3,r=`translate(${(s+2*o)*u.x+o}px, ${(s+2*o)*u.y+o}px) rotate(${90*i}deg) translate(0, -${s+2*o}px)`)},[l,s,i,r,u,o]}class $n extends Ie{constructor(e){super(),ke(this,e,On,Rn,Se,{position:4,exitSlot:0,cellSize:1,cellBorderSize:5})}}const ae=class ae{constructor(e,t){ee(this,"gameEnded");ee(this,"roundNumber");ee(this,"roundTiles");ee(this,"usedTileIndexes");ee(this,"usedSpecialTileIndexes");ee(this,"usedSpecialTileThisRound");ee(this,"board");this.gameEnded=(e==null?void 0:e.gameEnded)??!1,this.roundNumber=(e==null?void 0:e.roundNumber)??1,this.roundTiles=t??(e==null?void 0:e.roundTiles)??We(),this.usedTileIndexes=(e==null?void 0:e.usedTileIndexes)??[],this.usedSpecialTileIndexes=(e==null?void 0:e.usedSpecialTileIndexes)??[],this.usedSpecialTileThisRound=(e==null?void 0:e.usedSpecialTileThisRound)??!1,this.board=(e==null?void 0:e.board)??new V}get canUseSpecialTile(){return this.usedSpecialTileIndexes.length<3&&!this.usedSpecialTileThisRound}get availableSpecialTiles(){return this.canUseSpecialTile?Ve.filter((e,t)=>!this.usedSpecialTileIndexes.includes(t)):[]}get availableTiles(){return this.roundTiles.filter((e,t)=>!this.usedTileIndexes.includes(t)).filter((e,t,i)=>t===i.indexOf(e))}placeTile(e,t,i){const r=new Set(Ce(t)),u=i&&i.special===!1?i.index:this.roundTiles.findIndex((s,o)=>this.usedTileIndexes.includes(o)?!1:r.has(s));if(u!==-1)return new ae({...this,usedTileIndexes:[...this.usedTileIndexes,u],board:this.board.set(e,t)});const l=Ve.findIndex((s,o)=>this.usedSpecialTileIndexes.includes(o)?!1:r.has(s));if(l!==-1){if(!this.canUseSpecialTile)throw new Error("Cannot place special tile this round");return new ae({...this,usedSpecialTileIndexes:[...this.usedSpecialTileIndexes,l],usedSpecialTileThisRound:!0,board:this.board.set(e,t)})}throw new Error("Could not find tile to place")}makeMove(e){const{p:t,t:i}=Rt(e);return this.placeTile(t,i)}makeMoves(e){return e.reduce((t,i)=>t.makeMove(i),this)}get canEndRound(){return this.gameEnded?!1:this.roundTiles.every((e,t)=>{if(this.usedTileIndexes.includes(t))return!0;for(let i=0;i<V.size;i++)for(let r=0;r<V.size;r++)if(this.board.isValidWithTransform({y:i,x:r},e))return!1;return!0})}endRound(e){if(!this.canEndRound)throw new Error("Cannot end round");return this.roundNumber===ae.numRounds?new ae({...this,gameEnded:!0}):new ae({...this,roundNumber:this.roundNumber+1,roundTiles:e??We(),usedTileIndexes:[],usedSpecialTileThisRound:!1})}};ee(ae,"numRounds",7);let Oe=ae;const rt=qt((n,e)=>{const t=Ce(n).map(i=>{let r=0,u=0;for(const s of te){const o=i[s],c=e[s];if(o===A.NONE)(c===A.ROAD||c===A.RAIL)&&u++;else if(c===A.ROAD||c===A.RAIL)if(c===o)r++;else return null;else c===A.NONE&&u++}if(r===0)return null;const l=te.every(s=>i[s]!==A.UNFILLED);return{tTile:i,isSurrounded:l,numMatches:r,numErrors:u}}).filter(i=>!!i);return t.filter(({isSurrounded:i,numMatches:r,numErrors:u},l)=>i?!t.some((o,c)=>c!==l&&(o.numMatches>r||o.numMatches===r&&o.numErrors<u)):!0).map(({tTile:i})=>i)});function jn(n){let e=[],t=-1/0;for(const[i,r]of At(n,[],new Set)){const u=Ke(i.board).total;u>t&&(t=u,e=r)}return e}function*At(n,e,t){n.canEndRound&&(yield[n,e]);for(const i of An(n)){const r=[...e,i],u=[...r].sort().join("");t.has(u)||(t.add(u),yield*At(n.makeMove(i),r,t))}}function*An(n){const e=n.availableTiles;n.usedTileIndexes.length===1&&n.canUseSpecialTile&&e.push(...n.availableSpecialTiles);for(const[t,i]of n.board.openSlotEntries())for(const r of e)for(const u of rt(r,i))yield Je(t,u)}function Cn(n,e){const{p:t,t:i}=Rt(e),r=n.board.getOpenSlot(t);if(!r)throw new Error("Could not get slot for move");const u=te.filter(h=>i[h]!==A.NONE&&i[h]===r[h]).length,l=te.filter(h=>i[h]!==A.NONE&&r[h]===A.UNFILLED).length,s=te.filter(h=>i[h]!==A.NONE&&r[h]===A.NONE||i[h]===A.NONE&&(r[h]===A.ROAD||r[h]===A.RAIL)).length,o=t.y<=3?t.y:6-t.y,c=t.x<=3?t.x:6-t.x,a=[o,c].sort(),f=1+a[0]+4*a[1];return{numMatches:u,numOpen:l,numErrors:s,positionKey:f}}const Pn=[{yes:{count:10192,features:{numMatches:{1:9617,2:575},numOpen:{0:281,1:6838,2:2251,3:822},numErrors:{0:10192},positionKey:{1:48,5:3902,6:379,9:1453,10:353,11:47,13:2736,14:916,15:314,16:44}}},no:{count:272321,features:{numMatches:{1:270919,2:1402},numOpen:{0:3220,1:162550,2:89022,3:17529},numErrors:{0:271655,1:666},positionKey:{1:217,5:170355,6:3e3,9:11240,10:1682,11:163,13:82412,14:2887,15:340,16:25}}}},{yes:{count:10192,features:{numMatches:{1:8815,2:1371,3:6},numOpen:{0:656,1:6810,2:1973,3:753},numErrors:{0:10188,1:4},positionKey:{1:61,5:2659,6:791,9:1457,10:946,11:673,13:1299,14:756,15:1123,16:427}}},no:{count:276225,features:{numMatches:{1:268358,2:7866,3:1},numOpen:{0:10445,1:167032,2:83749,3:14999},numErrors:{0:264151,1:12051,2:23},positionKey:{1:735,5:140164,6:12611,9:26803,10:10794,11:5026,13:63581,14:7557,15:6855,16:2099}}}},{yes:{count:10192,features:{numMatches:{1:8501,2:1658,3:33},numOpen:{0:827,1:6849,2:1826,3:690},numErrors:{0:10182,1:10},positionKey:{1:65,5:2303,6:789,9:1337,10:1013,11:960,13:1190,14:730,15:1347,16:458}}},no:{count:268906,features:{numMatches:{1:254538,2:14347,3:21},numOpen:{0:14460,1:163831,2:76142,3:14473},numErrors:{0:245616,1:23048,2:240,3:2},positionKey:{1:875,5:117816,6:14788,9:30104,10:16251,11:11814,13:51715,14:9516,15:12637,16:3390}}}},{yes:{count:10192,features:{numMatches:{1:8108,2:2017,3:67},numOpen:{0:1053,1:6799,2:1714,3:626},numErrors:{0:10164,1:28},positionKey:{1:87,5:2329,6:797,9:1366,10:1182,11:1076,13:1095,14:762,15:1193,16:305}}},no:{count:252214,features:{numMatches:{1:231245,2:20819,3:150},numOpen:{0:17482,1:150849,2:69807,3:14076},numErrors:{0:218025,1:33436,2:731,3:22},positionKey:{1:1218,5:97516,6:16326,9:29977,10:20138,11:15059,13:41558,14:12076,15:14958,16:3388}}}},{yes:{count:12740,features:{numMatches:{1:7367,2:4711,3:642,4:20},numOpen:{0:1973,1:7134,2:2586,3:1047},numErrors:{0:12592,1:148},positionKey:{1:218,5:2567,6:1286,9:1716,10:1661,11:1123,13:1461,14:1099,15:1294,16:315}}},no:{count:393351,features:{numMatches:{1:336576,2:55488,3:1281,4:6},numOpen:{0:23580,1:147955,2:96153,3:125663},numErrors:{0:334357,1:56405,2:2519,3:70},positionKey:{1:5670,5:134011,6:27737,9:50884,10:42319,11:27210,13:51268,14:22653,15:25584,16:6015}}}},{yes:{count:12727,features:{numMatches:{1:6215,2:5781,3:724,4:7},numOpen:{0:2836,1:6937,2:2346,3:608},numErrors:{0:12340,1:383,2:4},positionKey:{1:401,5:2529,6:1228,9:1995,10:1879,11:1192,13:1112,14:920,15:1187,16:284}}},no:{count:289426,features:{numMatches:{1:243293,2:44865,3:1263,4:5},numOpen:{0:24960,1:125250,2:67808,3:71408},numErrors:{0:233044,1:53269,2:2926,3:187},positionKey:{1:10967,5:82921,6:21300,9:40926,10:41578,11:22617,13:27821,14:17578,15:19471,16:4247}}}},{yes:{count:12477,features:{numMatches:{1:5309,2:6273,3:872,4:23},numOpen:{0:4826,1:5336,2:1811,3:504},numErrors:{0:11121,1:1298,2:55,3:3},positionKey:{1:861,5:1776,6:1173,9:2191,10:2104,11:1385,13:676,14:878,15:1176,16:257}}},no:{count:208629,features:{numMatches:{1:182286,2:25308,3:1030,4:5},numOpen:{0:20839,1:97114,2:48482,3:42194},numErrors:{0:164586,1:40333,2:3400,3:310},positionKey:{1:12386,5:46192,6:16208,9:29957,10:41227,11:17515,13:13474,14:15463,15:13403,16:2804}}}}];function Vn(n,e){const t=Cn(n,e),i={yes:0,no:0},r=Pn[n.roundNumber-1];for(const u of["yes","no"]){const l=r[u].count/(r.yes.count+r.no.count),s=Object.entries(t).map(([o,c])=>c===0?1:r[u].features[o][c]/r[u].count);i[u]=s.reduce((o,c)=>o*c,l)}return i.yes/(i.yes+i.no)}function Bn(n){if(n.roundNumber===Oe.numRounds)return jn(n);const e=[];let t=[];for(;!n.canEndRound;){const i=Ct(n),r=Un(i,t);for(const l of i)for(let s=0;s<10;s++){const o=Et(n,l);t.push(o),Ye(r,o)}for(let l=0;l<4e3;l++){const s=Pe(i,c=>r[c].mean),o=Et(n,s);t.push(o),Ye(r,o)}const u=Pe(i,l=>r[l].mean);e.push(u),n=n.makeMove(u),t=t.filter(l=>l.moves.includes(u))}return e}function Ye(n,e){for(const t of e.moves)if(n[t]){const i=n[t].count,r=i+1,l=(n[t].mean*i+e.score)/r;n[t].mean=l,n[t].count=r}}function Un(n,e){const t=n.reduce((i,r)=>({...i,[r]:{count:0,mean:0}}),{});for(const i of e)Ye(t,i);return t}function Et(n,e,t=16){const i=[];for(e&&(i.push(e),n=n.makeMove(e));!n.canEndRound;){const o=wt(n,He(n,t));i.push(o),n=n.makeMove(o)}const r=n.board.countErrors().unfixable,u=Ot(n.board,!0);for(;!n.gameEnded;){for(;!n.canEndRound;){const o=wt(n,He(n,t));n=n.makeMove(o)}n=n.endRound()}const l=Ke(n.board),s=l.exits+l.rail+l.road+l.center-r+u/2;return{moves:i,score:s,realScore:l.total}}function wt(n,e){return Pe(e,t=>Vn(n,t))}function Ct(n,e=!1){const t=[],i=n.board.openSlotEntries(),r=e?!1:Pt(n),u=r?n.availableSpecialTiles:n.availableTiles;for(const[l,s]of i)for(const o of u)for(const c of rt(o,s))t.push(Je(l,c));return r&&t.length===0?Ct(n,!0):t}function He(n,e,t=!1){const i=[],r=Xe(n.board.openSlotEntries()),u=t?!1:Pt(n),l=Xe(u?n.availableSpecialTiles:n.availableTiles);for(const s of l)for(const[o,c]of r)for(const a of Xe(rt(s,c)))if(a&&(i.push(Je(o,a)),i.length>=e))return i;return u&&i.length===0?He(n,e,!0):i}function Pt(n){return n.roundNumber>=5&&n.usedTileIndexes.length===1&&n.canUseSpecialTile}function Kn(n,e,t){const i=n.slice();return i[14]=e[t][0],i[15]=e[t][1],i}function yt(n,e,t){const i=n.slice();return i[18]=e[t],i[20]=t,i}function St(n,e,t){const i=n.slice();return i[18]=e[t],i[22]=t,i}function Xn(n){let e,t,i=n[0].roundNumber+"",r,u,l=Oe.numRounds+"",s;return{c(){e=O("div"),t=X("Round "),r=X(i),u=X("/"),s=X(l)},l(o){e=$(o,"DIV",{});var c=D(e);t=q(c,"Round "),r=q(c,i),u=q(c,"/"),s=q(c,l),c.forEach(m)},m(o,c){N(o,e,c),b(e,t),b(e,r),b(e,u),b(e,s)},p(o,c){c&1&&i!==(i=o[0].roundNumber+"")&&xe(r,i)},d(o){o&&m(e)}}}function qn(n){let e,t="Game ended";return{c(){e=O("div"),e.textContent=t},l(i){e=$(i,"DIV",{"data-svelte-h":!0}),Nt(e)!=="svelte-10fa65y"&&(e.textContent=t)},m(i,r){N(i,e,r)},p:ce,d(i){i&&m(e)}}}function Gn(n){let e,t,i,r,u,l,s,o,c,a,f="✓",h,d,v;return t=new Qe({props:{tile:n[1].transformedTile}}),{c(){e=O("div"),he(t.$$.fragment),i=Y(),r=O("div"),u=O("div"),l=O("button"),s=X("↻"),c=Y(),a=O("button"),a.textContent=f,this.h()},l(E){e=$(E,"DIV",{class:!0});var I=D(e);de(t.$$.fragment,I),I.forEach(m),i=H(E),r=$(E,"DIV",{class:!0});var _=D(r);u=$(_,"DIV",{});var k=D(u);l=$(k,"BUTTON",{class:!0});var M=D(l);s=q(M,"↻"),M.forEach(m),k.forEach(m),c=H(_),a=$(_,"BUTTON",{class:!0,"data-svelte-h":!0}),Nt(a)!=="svelte-rod8ze"&&(a.textContent=f),_.forEach(m),this.h()},h(){w(e,"class","pending svelte-15c32mj"),w(l,"class","cellButton svelte-15c32mj"),l.disabled=o=n[1].validTransformedTiles.length<=1,ue(u,"background","white"),w(a,"class","cellButton svelte-15c32mj"),w(r,"class","cellButtonContainer svelte-15c32mj")},m(E,I){N(E,e,I),me(t,e,null),N(E,i,I),N(E,r,I),b(r,u),b(u,l),b(l,s),b(r,c),b(r,a),h=!0,d||(v=[ye(l,"click",n[4]),ye(a,"click",n[5])],d=!0)},p(E,I){const _={};I&2&&(_.tile=E[1].transformedTile),t.$set(_),(!h||I&2&&o!==(o=E[1].validTransformedTiles.length<=1))&&(l.disabled=o)},i(E){h||(G(t.$$.fragment,E),h=!0)},o(E){Z(t.$$.fragment,E),h=!1},d(E){E&&(m(e),m(i),m(r)),pe(t),d=!1,Mt(v)}}}function Fn(n){let e=n[0].board.isValidWithTransform({y:n[20],x:n[22]},n[1].selectedTile),t,i=e&&It(n);return{c(){i&&i.c(),t=le()},l(r){i&&i.l(r),t=le()},m(r,u){i&&i.m(r,u),N(r,t,u)},p(r,u){u&3&&(e=r[0].board.isValidWithTransform({y:r[20],x:r[22]},r[1].selectedTile)),e?i?i.p(r,u):(i=It(r),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:ce,o:ce,d(r){r&&m(t),i&&i.d(r)}}}function Wn(n){let e,t;return e=new Qe({props:{tile:n[0].board.get({y:n[20],x:n[22]})}}),{c(){he(e.$$.fragment)},l(i){de(e.$$.fragment,i)},m(i,r){me(e,i,r),t=!0},p(i,r){const u={};r&1&&(u.tile=i[0].board.get({y:i[20],x:i[22]})),e.$set(u)},i(i){t||(G(e.$$.fragment,i),t=!0)},o(i){Z(e.$$.fragment,i),t=!1},d(i){pe(e,i)}}}function It(n){let e,t,i;function r(){return n[10](n[20],n[22])}return{c(){e=O("button"),this.h()},l(u){e=$(u,"BUTTON",{class:!0}),D(e).forEach(m),this.h()},h(){w(e,"class","cellSelectionHighlight svelte-15c32mj")},m(u,l){N(u,e,l),t||(i=ye(e,"click",r),t=!0)},p(u,l){n=u},d(u){u&&m(e),t=!1,i()}}}function kt(n){let e,t,i,r,u;const l=[Wn,Fn,Gn],s=[];function o(c,a){return a&1&&(t=null),t==null&&(t=!!c[0].board.get({y:c[20],x:c[22]})),t?0:c[1].type==="tileSelected"?1:c[1].type==="tileAndPositionSelected"&&c[1].position.y===c[20]&&c[1].position.x===c[22]?2:-1}return~(i=o(n,-1))&&(r=s[i]=l[i](n)),{c(){e=O("div"),r&&r.c(),this.h()},l(c){e=$(c,"DIV",{class:!0});var a=D(e);r&&r.l(a),a.forEach(m),this.h()},h(){w(e,"class","cell svelte-15c32mj"),Ne(e,"centerSquare",Lt({y:n[20],x:n[22]}))},m(c,a){N(c,e,a),~i&&s[i].m(e,null),u=!0},p(c,a){let f=i;i=o(c,a),i===f?~i&&s[i].p(c,a):(r&&(Be(),Z(s[f],1,1,()=>{s[f]=null}),Ue()),~i?(r=s[i],r?r.p(c,a):(r=s[i]=l[i](c),r.c()),G(r,1),r.m(e,null)):r=null)},i(c){u||(G(r),u=!0)},o(c){Z(r),u=!1},d(c){c&&m(e),~i&&s[i].d()}}}function Dt(n){let e,t,i=fe({length:V.size}),r=[];for(let l=0;l<i.length;l+=1)r[l]=kt(St(n,i,l));const u=l=>Z(r[l],1,1,()=>{r[l]=null});return{c(){e=O("div");for(let l=0;l<r.length;l+=1)r[l].c();this.h()},l(l){e=$(l,"DIV",{});var s=D(e);for(let o=0;o<r.length;o+=1)r[o].l(s);s.forEach(m),this.h()},h(){ue(e,"display","flex")},m(l,s){N(l,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null);t=!0},p(l,s){if(s&59){i=fe({length:V.size});let o;for(o=0;o<i.length;o+=1){const c=St(l,i,o);r[o]?(r[o].p(c,s),G(r[o],1)):(r[o]=kt(c),r[o].c(),G(r[o],1),r[o].m(e,null))}for(Be(),o=i.length;o<r.length;o+=1)u(o);Ue()}},i(l){if(!t){for(let s=0;s<i.length;s+=1)G(r[s]);t=!0}},o(l){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Z(r[s]);t=!1},d(l){l&&m(e),ze(r,l)}}}function Yn(n){let e,t;return e=new $n({props:{position:n[14],exitSlot:n[15],cellSize:60,cellBorderSize:1}}),{c(){he(e.$$.fragment)},l(i){de(e.$$.fragment,i)},m(i,r){me(e,i,r),t=!0},p:ce,i(i){t||(G(e.$$.fragment,i),t=!0)},o(i){Z(e.$$.fragment,i),t=!1},d(i){pe(e,i)}}}function Hn(n){let e,t,i,r,u,l,s,o,c,a,f,h,d,v,E,I,_,k,M,T,x,p,y,z,C,U,P,K,J;t=new bt({props:{disabled:!n[0].canUseSpecialTile||n[0].gameEnded,tiles:Ve,usedTileIndexes:n[0].usedSpecialTileIndexes,selectedTileIndex:n[1].type!=="noSelection"&&n[1].special?n[1].index:void 0,onSelectTile:n[8]}}),s=new bt({props:{disabled:n[0].gameEnded,tiles:n[0].roundTiles,usedTileIndexes:n[0].usedTileIndexes,selectedTileIndex:n[1].type!=="noSelection"&&!n[1].special?n[1].index:void 0,onSelectTile:n[9]}});function Q(g,S){return g[0].gameEnded?qn:Xn}let oe=Q(n),L=oe(n);x=new cn({props:{board:n[0].board}});let R=fe({length:V.size}),j=[];for(let g=0;g<R.length;g+=1)j[g]=Dt(yt(n,R,g));const De=g=>Z(j[g],1,1,()=>{j[g]=null});let ve=fe(V.exitSlots.entries()),F=[];for(let g=0;g<ve.length;g+=1)F[g]=Yn(Kn(n,ve,g));return{c(){e=O("div"),he(t.$$.fragment),i=Y(),r=O("div"),u=Y(),l=O("div"),he(s.$$.fragment),o=Y(),c=O("div"),L.c(),a=Y(),f=O("button"),h=X("Next round"),v=Y(),E=O("button"),I=X("Solve round"),k=Y(),M=O("div"),T=Y(),he(x.$$.fragment),p=Y(),y=O("div"),z=Y(),C=O("div");for(let g=0;g<j.length;g+=1)j[g].c();U=Y();for(let g=0;g<F.length;g+=1)F[g].c();this.h()},l(g){e=$(g,"DIV",{class:!0});var S=D(e);de(t.$$.fragment,S),i=H(S),r=$(S,"DIV",{}),D(r).forEach(m),u=H(S),l=$(S,"DIV",{});var B=D(l);de(s.$$.fragment,B),o=H(B),c=$(B,"DIV",{class:!0});var se=D(c);L.l(se),a=H(se),f=$(se,"BUTTON",{class:!0});var Me=D(f);h=q(Me,"Next round"),Me.forEach(m),v=H(se),E=$(se,"BUTTON",{class:!0});var W=D(E);I=q(W,"Solve round"),W.forEach(m),se.forEach(m),B.forEach(m),k=H(S),M=$(S,"DIV",{}),D(M).forEach(m),T=H(S),de(x.$$.fragment,S),p=H(S),y=$(S,"DIV",{}),D(y).forEach(m),z=H(S),C=$(S,"DIV",{class:!0});var _e=D(C);for(let ge=0;ge<j.length;ge+=1)j[ge].l(_e);U=H(_e);for(let ge=0;ge<F.length;ge+=1)F[ge].l(_e);_e.forEach(m),S.forEach(m),this.h()},h(){ue(r,"height","20px"),w(f,"class","endRoundButton svelte-15c32mj"),f.disabled=d=!n[0].canEndRound,w(E,"class","endRoundButton svelte-15c32mj"),E.disabled=_=n[0].gameEnded,w(c,"class","endRoundButtonContainer svelte-15c32mj"),ue(l,"display","flex"),ue(l,"align-items","center"),ue(M,"height","20px"),ue(y,"height","40px"),w(C,"class","board svelte-15c32mj"),w(e,"class","container svelte-15c32mj")},m(g,S){N(g,e,S),me(t,e,null),b(e,i),b(e,r),b(e,u),b(e,l),me(s,l,null),b(l,o),b(l,c),L.m(c,null),b(c,a),b(c,f),b(f,h),b(c,v),b(c,E),b(E,I),b(e,k),b(e,M),b(e,T),me(x,e,null),b(e,p),b(e,y),b(e,z),b(e,C);for(let B=0;B<j.length;B+=1)j[B]&&j[B].m(C,null);b(C,U);for(let B=0;B<F.length;B+=1)F[B]&&F[B].m(C,null);P=!0,K||(J=[ye(f,"click",n[6]),ye(E,"click",n[7])],K=!0)},p(g,[S]){const B={};S&1&&(B.disabled=!g[0].canUseSpecialTile||g[0].gameEnded),S&1&&(B.usedTileIndexes=g[0].usedSpecialTileIndexes),S&2&&(B.selectedTileIndex=g[1].type!=="noSelection"&&g[1].special?g[1].index:void 0),t.$set(B);const se={};S&1&&(se.disabled=g[0].gameEnded),S&1&&(se.tiles=g[0].roundTiles),S&1&&(se.usedTileIndexes=g[0].usedTileIndexes),S&2&&(se.selectedTileIndex=g[1].type!=="noSelection"&&!g[1].special?g[1].index:void 0),s.$set(se),oe===(oe=Q(g))&&L?L.p(g,S):(L.d(1),L=oe(g),L&&(L.c(),L.m(c,a))),(!P||S&1&&d!==(d=!g[0].canEndRound))&&(f.disabled=d),(!P||S&1&&_!==(_=g[0].gameEnded))&&(E.disabled=_);const Me={};if(S&1&&(Me.board=g[0].board),x.$set(Me),S&59){R=fe({length:V.size});let W;for(W=0;W<R.length;W+=1){const _e=yt(g,R,W);j[W]?(j[W].p(_e,S),G(j[W],1)):(j[W]=Dt(_e),j[W].c(),G(j[W],1),j[W].m(C,U))}for(Be(),W=R.length;W<j.length;W+=1)De(W);Ue()}},i(g){if(!P){G(t.$$.fragment,g),G(s.$$.fragment,g),G(x.$$.fragment,g);for(let S=0;S<R.length;S+=1)G(j[S]);for(let S=0;S<ve.length;S+=1)G(F[S]);P=!0}},o(g){Z(t.$$.fragment,g),Z(s.$$.fragment,g),Z(x.$$.fragment,g),j=j.filter(Boolean);for(let S=0;S<j.length;S+=1)Z(j[S]);F=F.filter(Boolean);for(let S=0;S<F.length;S+=1)Z(F[S]);P=!1},d(g){g&&m(e),pe(t),pe(s),L.d(),pe(x),ze(j,g),ze(F,g),K=!1,Mt(J)}}}function Jn(n,e,t){const i=`${Math.random()}`,r=Nn(i);let u=new Oe(void 0,r[0]);const l=[];let s={type:"noSelection"};function o(_,k){t(1,s={type:"tileSelected",special:_,index:k,selectedTile:_?Ve[k]:u.roundTiles[k]})}function c(_){if(s.type==="tileSelected"){const k=u.board.getAllValidTransformedTiles(_,s.selectedTile);k.length&&t(1,s={type:"tileAndPositionSelected",special:s.special,index:s.index,position:_,validTransformedTiles:k,transformedTileIndex:0,transformedTile:k[0]})}}function a(){if(s.type==="tileAndPositionSelected"){const _=(s.transformedTileIndex+1)%s.validTransformedTiles.length;t(1,s={...s,transformedTileIndex:_,transformedTile:s.validTransformedTiles[_]})}}function f(){s.type==="tileAndPositionSelected"&&(l.push(`${s.position.y}${s.position.x}${s.validTransformedTiles[s.transformedTileIndex]}`),t(0,u=u.placeTile(s.position,s.validTransformedTiles[s.transformedTileIndex],s)),t(1,s={type:"noSelection"}))}function h(){t(0,u=u.endRound(r[u.roundNumber])),u.gameEnded&&console.log({seed:i,score:Ke(u.board).total,moves:l})}function d(){const _=Bn(u);t(0,u=u.makeMoves(_).endRound(r[u.roundNumber]))}return[u,s,o,c,a,f,h,d,_=>o(!0,_),_=>o(!1,_),(_,k)=>c({y:_,x:k})]}class Qn extends Ie{constructor(e){super(),ke(this,e,Jn,Hn,Se,{})}}function Zn(n){let e,t;return e=new Qn({}),{c(){he(e.$$.fragment)},l(i){de(e.$$.fragment,i)},m(i,r){me(e,i,r),t=!0},p:ce,i(i){t||(G(e.$$.fragment,i),t=!0)},o(i){Z(e.$$.fragment,i),t=!1},d(i){pe(e,i)}}}class ii extends Ie{constructor(e){super(),ke(this,e,null,Zn,Se,{})}}export{ii as component};
